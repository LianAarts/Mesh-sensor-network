\hypertarget{rd__22__wifi_8cpp}{}\doxysection{/\+Users/lian/\+Documents/\+Platform\+IO/\+Projects/rootselection/src/rd\+\_\+22\+\_\+wifi.cpp File Reference}
\label{rd__22__wifi_8cpp}\index{/Users/lian/Documents/PlatformIO/Projects/rootselection/src/rd\_22\_wifi.cpp@{/Users/lian/Documents/PlatformIO/Projects/rootselection/src/rd\_22\_wifi.cpp}}
{\ttfamily \#include $<$Arduino.\+h$>$}\newline
{\ttfamily \#include $<$Arduino\+Json.\+h$>$}\newline
{\ttfamily \#include $<$HTTPClient.\+h$>$}\newline
{\ttfamily \#include $<$Wi\+Fi.\+h$>$}\newline
{\ttfamily \#include \char`\"{}rd\+\_\+22\+\_\+configuration.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}rd\+\_\+22\+\_\+debug.\+h\char`\"{}}\newline
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{rd__22__wifi_8cpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}}~\mbox{\hyperlink{rd__22__configuration_8h_ac2d33ccaf63f5d5b66552b95426c0137}{DEBUG\+\_\+\+LEVEL}}
\item 
\#define \mbox{\hyperlink{rd__22__wifi_8cpp_a29ec70fa12d4cf5af9b0aadd7bc27875}{token}}~\mbox{\hyperlink{rd__22__configuration_8h_a33ea1b9be62c9bbff886118f9049a69d}{token\+\_\+secr}}
\item 
\#define \mbox{\hyperlink{rd__22__wifi_8cpp_ac015ef281be46553436f6ee16b2e5e68}{ssid\+Scan}}~\mbox{\hyperlink{rd__22__configuration_8h_a90f959ea05d387935fea4a9951f9c5c9}{ssid\+Scan\+\_\+secr}}
\item 
\#define \mbox{\hyperlink{rd__22__wifi_8cpp_a3f54551baefecea1c8b34f25378585c1}{pass\+Scan}}~\mbox{\hyperlink{rd__22__configuration_8h_a5cee90982c1f736f726dea41b4d5a583}{pass\+Scan\+\_\+secr}}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
String \mbox{\hyperlink{rd__22__wifi_8cpp_a7f6ad1fbb8ddfbceb2416ca94574252a}{get\+Ip}} ()
\item 
void \mbox{\hyperlink{rd__22__wifi_8cpp_a433a2bfe9f984e7dbd6e66f7a251852d}{post}} (String sensor\+Val, String name, String unit)
\begin{DoxyCompactList}\small\item\em Post the measurement to the Home Assistant REST API. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{rd__22__wifi_8cpp_ab59433792d0c66f5863aff6b77069863}{network\+Scan}} ()
\begin{DoxyCompactList}\small\item\em Measure the RSSI of the Home Assistant access point. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{rd__22__wifi_8cpp_a6d6c298c788eeb7b18a19d82a77761b3}{setup\+Network}} ()
\begin{DoxyCompactList}\small\item\em Connect to the Home Assistant access point. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{rd__22__wifi_8cpp_aa400750636d4d4831176d9358a10ad2b}{split\+Json}} (String json)
\begin{DoxyCompactList}\small\item\em Split the received JSON in individual measurements so we can POST them to Home Assistant. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const char $\ast$ \mbox{\hyperlink{rd__22__wifi_8cpp_a5905a4fd1b69ca81f7dc29f26192adfc}{test}} = \char`\"{}home-\/assistant-\/AP\char`\"{}
\item 
HTTPClient \mbox{\hyperlink{rd__22__wifi_8cpp_a58eddff149cd37cc3f16deb0bf67c9c0}{http}}
\item 
Wi\+Fi\+Client \mbox{\hyperlink{rd__22__wifi_8cpp_a323dfc205549b3c13f0a25c1b670708a}{client}}
\item 
IPAddress \mbox{\hyperlink{rd__22__wifi_8cpp_a863c214d56d28a55467c000641e1be91}{ip}}
\item 
String \mbox{\hyperlink{rd__22__wifi_8cpp_a76dee866cef104107a6bb2bc8a492924}{http\+Request\+Data}} = \char`\"{}\char`\"{}
\item 
String \mbox{\hyperlink{rd__22__wifi_8cpp_a114aa1458f71b84775e6274fc63a00f9}{http\+Atributes}} = \char`\"{}\char`\"{}
\item 
int \mbox{\hyperlink{rd__22__wifi_8cpp_a37c34f4f38cdb432d71a76d70ea582ba}{http\+Response\+Code}} = 0
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{rd__22__wifi_8cpp_ad72dbcf6d0153db1b8d8a58001feed83}\label{rd__22__wifi_8cpp_ad72dbcf6d0153db1b8d8a58001feed83}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!DEBUG@{DEBUG}}
\index{DEBUG@{DEBUG}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{DEBUG}{DEBUG}}
{\footnotesize\ttfamily \#define DEBUG~\mbox{\hyperlink{rd__22__configuration_8h_ac2d33ccaf63f5d5b66552b95426c0137}{DEBUG\+\_\+\+LEVEL}}}

\mbox{\Hypertarget{rd__22__wifi_8cpp_a3f54551baefecea1c8b34f25378585c1}\label{rd__22__wifi_8cpp_a3f54551baefecea1c8b34f25378585c1}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!passScan@{passScan}}
\index{passScan@{passScan}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{passScan}{passScan}}
{\footnotesize\ttfamily \#define pass\+Scan~\mbox{\hyperlink{rd__22__configuration_8h_a5cee90982c1f736f726dea41b4d5a583}{pass\+Scan\+\_\+secr}}}

\mbox{\Hypertarget{rd__22__wifi_8cpp_ac015ef281be46553436f6ee16b2e5e68}\label{rd__22__wifi_8cpp_ac015ef281be46553436f6ee16b2e5e68}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!ssidScan@{ssidScan}}
\index{ssidScan@{ssidScan}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{ssidScan}{ssidScan}}
{\footnotesize\ttfamily \#define ssid\+Scan~\mbox{\hyperlink{rd__22__configuration_8h_a90f959ea05d387935fea4a9951f9c5c9}{ssid\+Scan\+\_\+secr}}}

\mbox{\Hypertarget{rd__22__wifi_8cpp_a29ec70fa12d4cf5af9b0aadd7bc27875}\label{rd__22__wifi_8cpp_a29ec70fa12d4cf5af9b0aadd7bc27875}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!token@{token}}
\index{token@{token}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{token}{token}}
{\footnotesize\ttfamily \#define token~\mbox{\hyperlink{rd__22__configuration_8h_a33ea1b9be62c9bbff886118f9049a69d}{token\+\_\+secr}}}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{rd__22__wifi_8cpp_a7f6ad1fbb8ddfbceb2416ca94574252a}\label{rd__22__wifi_8cpp_a7f6ad1fbb8ddfbceb2416ca94574252a}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!getIp@{getIp}}
\index{getIp@{getIp}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{getIp()}{getIp()}}
{\footnotesize\ttfamily String get\+Ip (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\mbox{\Hypertarget{rd__22__wifi_8cpp_ab59433792d0c66f5863aff6b77069863}\label{rd__22__wifi_8cpp_ab59433792d0c66f5863aff6b77069863}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!networkScan@{networkScan}}
\index{networkScan@{networkScan}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{networkScan()}{networkScan()}}
{\footnotesize\ttfamily int network\+Scan (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Measure the RSSI of the Home Assistant access point. 

Received Signal Strength Indicator (RSSI) is the measurement of how strong the signal of a router or access point is to a device. The RSSI is a value between -\/100 and 0. Close to 0 means a better connection

There is no connection to the access point. We search the index of the desired network and we measure the RSSI.

\begin{DoxyReturn}{Returns}
int RSSI, a value between -\/100 and 0 
\end{DoxyReturn}
\mbox{\Hypertarget{rd__22__wifi_8cpp_a433a2bfe9f984e7dbd6e66f7a251852d}\label{rd__22__wifi_8cpp_a433a2bfe9f984e7dbd6e66f7a251852d}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!post@{post}}
\index{post@{post}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{post()}{post()}}
{\footnotesize\ttfamily void post (\begin{DoxyParamCaption}\item[{String}]{sensor\+Val,  }\item[{String}]{name,  }\item[{String}]{unit }\end{DoxyParamCaption})}



Post the measurement to the Home Assistant REST API. 

doxygen

This will be an individual entity that can display one value. One sensor will need multiple Posts if it measures more than one value.

We always check the HTTP response of the POST. If the response is -\/1 we don\textquotesingle{}t have a connection to Home Assistant. If this happens we reset the node.


\begin{DoxyParams}{Parameters}
{\em sensor\+Val} & Value of the measurement \\
\hline
{\em name} & Entity ID used in Home Assistant \\
\hline
{\em unit} & Unit of measurement \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{rd__22__wifi_8cpp_a6d6c298c788eeb7b18a19d82a77761b3}\label{rd__22__wifi_8cpp_a6d6c298c788eeb7b18a19d82a77761b3}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!setupNetwork@{setupNetwork}}
\index{setupNetwork@{setupNetwork}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{setupNetwork()}{setupNetwork()}}
{\footnotesize\ttfamily void setup\+Network (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Connect to the Home Assistant access point. 

When we are the root we need to send Post requests. We need to connect to the access point to be able to do this. why delay (do some research)\mbox{\Hypertarget{rd__22__wifi_8cpp_aa400750636d4d4831176d9358a10ad2b}\label{rd__22__wifi_8cpp_aa400750636d4d4831176d9358a10ad2b}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!splitJson@{splitJson}}
\index{splitJson@{splitJson}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{splitJson()}{splitJson()}}
{\footnotesize\ttfamily void split\+Json (\begin{DoxyParamCaption}\item[{String}]{json }\end{DoxyParamCaption})}



Split the received JSON in individual measurements so we can POST them to Home Assistant. 


\begin{DoxyParams}{Parameters}
{\em json} & JSON input we want to split up \\
\hline
\end{DoxyParams}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{rd__22__wifi_8cpp_a323dfc205549b3c13f0a25c1b670708a}\label{rd__22__wifi_8cpp_a323dfc205549b3c13f0a25c1b670708a}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!client@{client}}
\index{client@{client}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{client}{client}}
{\footnotesize\ttfamily Wi\+Fi\+Client client}

\mbox{\Hypertarget{rd__22__wifi_8cpp_a58eddff149cd37cc3f16deb0bf67c9c0}\label{rd__22__wifi_8cpp_a58eddff149cd37cc3f16deb0bf67c9c0}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!http@{http}}
\index{http@{http}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{http}{http}}
{\footnotesize\ttfamily HTTPClient http}

\mbox{\Hypertarget{rd__22__wifi_8cpp_a114aa1458f71b84775e6274fc63a00f9}\label{rd__22__wifi_8cpp_a114aa1458f71b84775e6274fc63a00f9}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!httpAtributes@{httpAtributes}}
\index{httpAtributes@{httpAtributes}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{httpAtributes}{httpAtributes}}
{\footnotesize\ttfamily String http\+Atributes = \char`\"{}\char`\"{}}

\mbox{\Hypertarget{rd__22__wifi_8cpp_a76dee866cef104107a6bb2bc8a492924}\label{rd__22__wifi_8cpp_a76dee866cef104107a6bb2bc8a492924}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!httpRequestData@{httpRequestData}}
\index{httpRequestData@{httpRequestData}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{httpRequestData}{httpRequestData}}
{\footnotesize\ttfamily String http\+Request\+Data = \char`\"{}\char`\"{}}

\mbox{\Hypertarget{rd__22__wifi_8cpp_a37c34f4f38cdb432d71a76d70ea582ba}\label{rd__22__wifi_8cpp_a37c34f4f38cdb432d71a76d70ea582ba}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!httpResponseCode@{httpResponseCode}}
\index{httpResponseCode@{httpResponseCode}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{httpResponseCode}{httpResponseCode}}
{\footnotesize\ttfamily int http\+Response\+Code = 0}

\mbox{\Hypertarget{rd__22__wifi_8cpp_a863c214d56d28a55467c000641e1be91}\label{rd__22__wifi_8cpp_a863c214d56d28a55467c000641e1be91}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!ip@{ip}}
\index{ip@{ip}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{ip}{ip}}
{\footnotesize\ttfamily IPAddress ip}

\mbox{\Hypertarget{rd__22__wifi_8cpp_a5905a4fd1b69ca81f7dc29f26192adfc}\label{rd__22__wifi_8cpp_a5905a4fd1b69ca81f7dc29f26192adfc}} 
\index{rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}!test@{test}}
\index{test@{test}!rd\_22\_wifi.cpp@{rd\_22\_wifi.cpp}}
\doxysubsubsection{\texorpdfstring{test}{test}}
{\footnotesize\ttfamily const char$\ast$ test = \char`\"{}home-\/assistant-\/AP\char`\"{}}

